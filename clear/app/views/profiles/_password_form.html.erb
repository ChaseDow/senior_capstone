<turbo-frame id="event_drawer">
  <div class="p-5 space-y-4">
    <div>
      <h2 class="text-lg font-semibold text-zinc-50">Change password</h2>
    </div>

    <%= form_with model: user,
          url: update_password_profile_path,
          method: :patch,
          data: { turbo_frame: "event_drawer" } do |f| %>

      <% if user.errors.any? %>
        <div class="rounded-xl border border-red-900/40 bg-red-950/30 p-3 text-sm text-red-200">
          <ul class="list-disc pl-5">
            <% user.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="space-y-4">
        <div class="relative">
            <%= f.label :current_password, "Current password", class: "text-sm text-zinc-300" %>
            <%= f.password_field :current_password,
                id: "current-password",
                autocomplete: "current-password",
                class: "mt-2 w-full rounded-xl border border-zinc-800 bg-zinc-950/60 px-3 py-2 text-zinc-100 placeholder-zinc-500 focus:border-emerald-500/60 focus:outline-none focus:ring-2 focus:ring-emerald-500/30",
                placeholder: "your current password" %>

            <button type="button"
                    id="toggle_password"
                    class="absolute right-3 top-[calc(50%+1rem)] -translate-y-1/2
                        rounded-md p-1
                        text-zinc-400
                        hover:text-zinc-100
                        hover:bg-zinc-800/60
                        focus:outline-none
                        focus:ring-2 focus:ring-emerald-500/40
                        transition">
            <span id="icon-show">
              <%= icon "eye-stroke-rounded", class: "h-5 w-5 text-emerald-500/40" %>
            </span>
            <span id="icon-hide" class="hidden">
              <%= icon "view-off-slash-stroke-rounded", class: "h-5 w-5 text-emerald-500/40" %>
            </span>
            </button>
        </div>

        <div class="relative">
          <%= f.label :password, "New password", class: "text-sm text-zinc-300" %>
          <%= f.password_field :password,
                id: "new-password",
                autocomplete: "new-password",
                class: "mt-2 w-full rounded-xl border border-zinc-800 bg-zinc-950/60 px-3 py-2 text-zinc-100 placeholder-zinc-500 focus:border-emerald-500/60 focus:outline-none focus:ring-2 focus:ring-emerald-500/30",
                placeholder: "your new password" %>

          <button type="button"
            data-toggle="password"
            data-target="new-password"
            data-show="new-icon-show"
            data-hide="new-icon-hide"
            class="absolute right-3 top-[calc(50%+1rem)] -translate-y-1/2 rounded-md p-1 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800/60 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 transition">
            <span id="new-icon-show">
              <%= icon "eye-stroke-rounded", class: "h-5 w-5 text-emerald-500/40" %>
            </span>
            <span id="new-icon-hide" class="hidden">
              <%= icon "view-off-slash-stroke-rounded", class: "h-5 w-5 text-emerald-500/40" %>
            </span>
          </button>
        </div>

        <div class="relative">
          <%= f.label :password_confirmation, "Confirm new password", class: "text-sm text-zinc-300" %>
          <%= f.password_field :password_confirmation,
                id: "confirm-password",
                autocomplete: "new-password",
                class: "mt-2 w-full rounded-xl border border-zinc-800 bg-zinc-950/60 px-3 py-2 text-zinc-100 placeholder-zinc-500 focus:border-emerald-500/60 focus:outline-none focus:ring-2 focus:ring-emerald-500/30",
                placeholder: "re-type new password" %>

          <button type="button"
            data-toggle="password"
            data-target="confirm-password"
            data-show="confirm-icon-show"
            data-hide="confirm-icon-hide"
            class="absolute right-3 top-[calc(50%+1rem)] -translate-y-1/2 rounded-md p-1 text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800/60 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 transition">
            <span id="confirm-icon-show">
              <%= icon "eye-stroke-rounded", class: "h-5 w-5 text-emerald-500/40" %>
            </span>
            <span id="confirm-icon-hide" class="hidden">
              <%= icon "view-off-slash-stroke-rounded", class: "h-5 w-5 text-emerald-500/40" %>
            </span>
          </button>
        </div>

        <%= f.submit "Update password",
              class: "mt-2 w-full rounded-xl bg-emerald-500 px-4 py-2 text-sm font-medium text-zinc-950 hover:bg-emerald-400" %>

        <%= link_to profile_path,
              data: { turbo_frame: "event_drawer", turbo_prefetch: false },
              class: "block w-full text-center rounded-xl border border-zinc-800 px-4 py-2 text-sm text-zinc-200 hover:bg-zinc-800/40" do %>
          Cancel
        <% end %>
      </div>
    <% end %>
  </div>
</turbo-frame>

<script>
  document.addEventListener("turbo:load", () => {
    document.querySelectorAll('[data-toggle="password"]').forEach((btn) => {
      btn.addEventListener("click", () => {
        const input = document.getElementById(btn.dataset.target);
        const showIcon = document.getElementById(btn.dataset.show);
        const hideIcon = document.getElementById(btn.dataset.hide);

        const isHidden = input.type === "password";
        input.type = isHidden ? "text" : "password";
        showIcon.classList.toggle("hidden", isHidden);
        hideIcon.classList.toggle("hidden", !isHidden);
      });
    });
  });
</script>
