<%# app/views/events/_form.html.erb %>
<% start_date_param = local_assigns[:start_date].presence || params[:start_date].presence %>
<% turbo_enabled = local_assigns.key?(:turbo) ? local_assigns[:turbo] : true %>

<% form_url =
    if event.persisted?
      start_date_param ? event_path(event, start_date: start_date_param) : event_path(event)
    else
      start_date_param ? events_path(start_date: start_date_param) : events_path
    end
%>

<%= form_with model: event,
              url: form_url,
              class: "space-y-4",
              data: { drawer_close_on_success: "false", turbo: turbo_enabled } do |f| %>

  <%= hidden_field_tag :start_date, start_date_param if start_date_param.present? %>

  <% if event.errors.any? %>
    <div class="rounded-2xl border border-red-900 bg-red-950/40 p-4 text-red-200">
      <p class="font-medium">Please fix the following:</p>
      <ul class="mt-2 list-disc pl-6 text-sm">
        <% event.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= render "form_fields", f: f %>

  <div class="flex items-center gap-2 pt-2">
    <%= render Studs::PrimaryButtonComponent.new(
          label: (event.persisted? ? "Update event" : "Create event"),
          type: "submit",
          color: :emerald
        ) %>

    <% if local_assigns[:cancel_drawer] %>
      <button
        type="button"
        data-action="drawer#close"
        class="inline-flex items-center rounded-xl border border-zinc-800 bg-zinc-950/40 px-4 py-2 text-sm text-zinc-200 hover:bg-zinc-800/40 transition">
        Cancel
      </button>
    <% else %>
      <%= render Studs::SecondaryButtonComponent.new(label: "Cancel", href: events_path) %>
    <% end %>
  </div>
<% end %>
