<%# app/views/events/_form_fields.html.erb %>
<% input_classes = "mt-1 w-full rounded-xl border border-zinc-800 bg-zinc-950/40 px-3 py-1.5 text-sm text-zinc-100 placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-emerald-300/40" %>
<% label_classes = "block text-sm font-medium text-zinc-200" %>

<div class="space-y-4">
  <div>
    <%= f.label :title, class: label_classes %>
    <%= f.text_field :title, class: input_classes, placeholder: "e.g. Gym session, Study group..." %>
  </div>

  <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
    <div>
      <%= f.label :starts_at, "Start time", class: label_classes %>
      <%= f.datetime_local_field :starts_at, class: input_classes %>
    </div>

    <div>
      <%= f.label :ends_at, "End time (optional)", class: label_classes %>
      <%= f.datetime_local_field :ends_at, class: input_classes %>
    </div>
  </div>

  <div>
    <%= f.label :location, class: label_classes %>
    <%= f.text_field :location, class: input_classes, placeholder: "e.g. Library, Room 210" %>
  </div>

  <div>
    <%= f.label :priority, class: label_classes %>
    <%= f.text_field :priority, class: input_classes, placeholder: "rank your event's priority with a number" %>
  </div>

  <div>
    <%= f.label :description, class: label_classes %>
    <%= f.text_area :description, rows: 3, class: input_classes, placeholder: "Optional notes..." %>
  </div>

  <div class="grid grid-cols-1 gap-4 md:grid-cols-2 items-start">
    <!-- Repeat card -->
    <div class="self-start rounded-2xl border border-emerald-900/30 bg-emerald-950/10 p-4 relative">
      <%= f.check_box :recurring,
            class: "peer absolute top-4 right-4 h-5 w-5 rounded border-zinc-700 bg-zinc-950/40 accent-emerald-400" %>

      <div class="pr-10">
        <div class="text-sm font-medium text-zinc-200">Repeat</div>
        <div class="text-xs text-zinc-400">Repeat on selected weekdays until a date</div>
      </div>

      <div class="mt-4 space-y-3 hidden peer-checked:block">
        <div class="text-xs text-zinc-400">Days</div>

        <div class="grid grid-cols-7 gap-2">
          <% day_labels = [["Su", 0], ["Mo", 1], ["Tu", 2], ["We", 3], ["Th", 4], ["Fr", 5], ["Sa", 6]] %>

          <% day_labels.each do |lbl, wday| %>
            <label class="relative">
              <%= f.check_box :repeat_days, { multiple: true, class: "peer sr-only" }, wday, nil %>

              <div class="flex h-9 items-center justify-center rounded-xl border border-zinc-800 bg-zinc-950/30
                          text-xs font-medium text-zinc-300 transition
                          hover:bg-zinc-900/40
                          peer-checked:border-emerald-200
                          peer-checked:bg-emerald-400/70
                          peer-checked:text-white
                          peer-checked:ring-2 peer-checked:ring-emerald-200/70">
                <%= lbl %>
              </div>

              <span class="pointer-events-none absolute right-2 top-1/2 hidden -translate-y-1/2 text-[10px] text-white peer-checked:inline">
                ✓
              </span>
            </label>
          <% end %>
        </div>

        <div>
          <%= f.label :repeat_until, "Repeat until", class: label_classes %>
          <%= f.date_field :repeat_until, class: input_classes %>
        </div>

        <p class="text-xs text-zinc-500">
          Turn Repeat off to make this a one-time event.
        </p>
      </div>
    </div>

    <!-- Label card (single-frame swap) -->
    <div class="self-start rounded-2xl border border-emerald-900/30 bg-emerald-950/10 p-4">
      <%= turbo_frame_tag "event_label_area" do %>
        <% labels = Array(@labels) %>
        <% selected_id = f.object.label_id %>
        <% picked = labels.find { |l| l.id == selected_id } %>

        <div class="flex items-start justify-between gap-3">
          <div class="flex-1">
            <div class="text-sm font-medium text-zinc-200">Label</div>
            <div class="text-xs text-zinc-400">Used for color + grouping in the calendar.</div>

            <div class="mt-3">
              <label class="<%= label_classes %>" for="event_label_id">Choose label</label>

              <!-- plain select so the frame can be replaced without needing `f` -->
              <select name="event[label_id]" id="event_label_id" class="<%= input_classes %>">
                <option value="">None</option>
                <% labels.each do |lbl| %>
                  <option value="<%= lbl.id %>" <%= "selected" if lbl.id == selected_id %>><%= lbl.name %></option>
                <% end %>
              </select>
            </div>

            <div class="mt-3 text-xs text-zinc-400">
              Don’t see it?
              <%= link_to "Create a label",
                    new_label_path(turbo_frame: "event_label_area"),
                    data: { turbo_frame: "event_label_area" },
                    class: "text-emerald-200 hover:text-emerald-100 underline underline-offset-2" %>
            </div>
          </div>

          <% if picked&.color.present? %>
            <div class="mt-7 h-10 w-14 rounded-xl border border-zinc-800" style="background:<%= picked.color %>"></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
