<%# app/views/labels/_form.html.erb %>
<% input_classes = "mt-1 w-full rounded-xl border border-zinc-800 bg-zinc-950/40 px-3 py-1.5 text-sm text-zinc-100 placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-emerald-300/40" %>
<% label_classes = "block text-sm font-medium text-zinc-200" %>

<%# IMPORTANT: default to the one-frame id used by the event form %>
<% turbo_frame = local_assigns[:turbo_frame].presence || "event_label_area" %>

<%= form_with model: label,
              url: (label.persisted? ? label_path(label, turbo_frame: turbo_frame) : labels_path(turbo_frame: turbo_frame)),
              data: { turbo_frame: turbo_frame } do |f| %>

  <% if label.errors.any? %>
    <div class="mt-3 rounded-2xl border border-red-900 bg-red-950/40 p-3 text-red-200">
      <ul class="list-disc pl-5 text-sm">
        <% label.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-2">
    <div>
      <%= f.label :name, class: label_classes %>
      <%= f.text_field :name, class: input_classes, placeholder: "e.g. Exam, Work, Gym" %>
    </div>

    <div>
      <%= f.label :color, class: label_classes %>
      <div class="mt-1 flex items-center gap-3">
        <%= f.color_field :color,
              class: "h-10 w-14 cursor-pointer rounded-xl border border-zinc-800 bg-zinc-950/40" %>
        <div class="text-xs text-zinc-400">Label color</div>
      </div>
    </div>
  </div>

  <div class="mt-4 flex items-center gap-2">
    <%= render Studs::PrimaryButtonComponent.new(label: (label.persisted? ? "Update label" : "Save label"), type: "submit", color: :emerald) %>

    <%# If this form is being shown inside a turbo frame (inline picker), close it. Otherwise go back to index. %>
    <% if turbo_frame.present? %>
      <button
        type="button"
        class="inline-flex items-center rounded-xl border border-zinc-800 bg-zinc-950/40 px-4 py-2 text-sm text-zinc-200 hover:bg-zinc-800/40 transition"
        onclick="document.getElementById('<%= turbo_frame %>').innerHTML=''; return false;">
        Cancel
      </button>
    <% else %>
      <%= link_to "Cancel",
            labels_path,
            class: "inline-flex items-center rounded-xl border border-zinc-800 bg-zinc-950/40 px-4 py-2 text-sm text-zinc-200 hover:bg-zinc-800/40 transition" %>
    <% end %>
  </div>
<% end %>
