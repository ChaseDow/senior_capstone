<% course_items = course.course_items.order(:due_at) %>
<% course_item  = course.course_items.new %>

<div class="mt-6 rounded-2xl border border-emerald-900/35 bg-emerald-950/15 backdrop-blur-sm p-4">
  <div class="flex items-center justify-between">
    <div>
      <p class="text-sm font-semibold text-zinc-100">Course items</p>
      <p class="text-xs text-zinc-400">Assignments, exams, presentations, seminars, etc.</p>
    </div>

    <%= render Studs::SecondaryButtonComponent.new(
          path: course_course_items_path(course),
          label: "Manage",
          size: :sm
        ) %>
  </div>

  <div class="mt-3">
    <%= form_with model: [course, course_item] do |f| %>
      <div class="grid gap-3 md:grid-cols-6 items-end">
        <div class="md:col-span-3">
          <%= f.label :title, class: "block text-xs font-medium text-zinc-300" %>
          <%= f.text_field :title,
                class: "mt-1 w-full rounded-xl border border-zinc-800 bg-zinc-950/40 px-3 py-2 text-sm text-zinc-100 placeholder:text-zinc-500" %>
        </div>

        <div class="md:col-span-1">
          <%= f.label :kind, class: "block text-xs font-medium text-zinc-300" %>
          <%= f.select :kind,
                CourseItem.kinds.keys.map { |k| [k.humanize, k] },
                {},
                class: "mt-1 w-full rounded-xl border border-zinc-800 bg-zinc-950/40 px-3 py-2 text-sm text-zinc-100" %>
        </div>

        <div class="md:col-span-2">
          <%= f.label :due_at, "Due", class: "block text-xs font-medium text-zinc-300" %>
          <%= f.datetime_local_field :due_at,
                class: "mt-1 w-full rounded-xl border border-zinc-800 bg-zinc-950/40 px-3 py-2 text-sm text-zinc-100" %>
        </div>

        <div class="md:col-span-6 flex justify-end">
          <%= render Studs::PrimaryButtonComponent.new(label: "Add item", color: :emerald) %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-3">
    <% if course_items.any? %>
      <div class="divide-y divide-emerald-900/25 overflow-hidden rounded-2xl border border-emerald-900/30 bg-emerald-950/10">
        <% course_items.limit(6).each do |item| %>
          <div class="flex items-start justify-between gap-3 p-3">
            <div class="min-w-0">
              <p class="truncate text-sm font-medium text-zinc-100"><%= item.title %></p>
              <p class="mt-0.5 text-xs text-zinc-400"><%= item.kind.humanize %> • <%= l(item.due_at) %></p>
            </div>

            <div class="flex shrink-0 items-center gap-2">
              <%= render Studs::SecondaryButtonComponent.new(
                    path: edit_course_course_item_path(course, item),
                    label: "Edit",
                    size: :sm
                  ) %>

              <%= button_to "Delete",
                    course_course_item_path(course, item),
                    method: :delete,
                    form: { data: { turbo_confirm: "Delete this item?" } },
                    class: "inline-flex items-center justify-center rounded-xl px-3 py-2 text-xs font-medium
                            border border-red-500/40 text-red-200 hover:bg-red-950/40 transition" %>
            </div>
          </div>
        <% end %>

        <% if course_items.count > 6 %>
          <div class="p-3 text-xs text-zinc-400">
            Showing 6 of <%= course_items.count %>. Use “Manage” to see all.
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-sm text-zinc-400">No course items yet.</p>
    <% end %>
  </div>
</div>