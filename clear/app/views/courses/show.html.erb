<% content_for :page_title, "Courses" %>
<% content_for :page_subtitle, "Current enrolled courses"%>
<div class="rounded-2xl border border-zinc-800 bg-zinc-900/40 p-6 space-y-6">
  <% if notice.present? %>
    <div class="rounded-2xl border border-emerald-900 bg-emerald-950/40 px-4 py-3 text-sm text-emerald-200">
      <%= notice %>
    </div>
  <% end %>

  <div class="flex items-start justify-between gap-4">
    <div class="min-w-0">
      <h1 class="text-2xl font-semibold text-zinc-100 truncate">
        <%= @course.title.presence || "(Untitled)" %>
      </h1>

      <div class="mt-1 text-sm text-zinc-300">
        <% details = [] %>
        <% details << @course.term if @course.term.present? %>
        <% details << @course.professor if @course.professor.present? %>
        <% details << @course.location if @course.location.present? %>
        <%= details.join(" • ") %>
      </div>
      
      <div class="mt-2 text-sm text-zinc-400">
        <% if @course.start_time.present? && @course.end_time.present? %>
          <% day_labels = [["Sun", 0], ["Mon", 1], ["Tue", 2], ["Wed", 3], ["Thu", 4], ["Fri", 5], ["Sat", 6]] %>
          <% day_map = day_labels.map { |lbl, wday| [wday, lbl] }.to_h %>

          <% selected_days =
            Array(@course.repeat_days)
              .sort
              .map { |d| day_map[d] }
              .compact
              .join("|")
          %>
          <%= selected_days %>
          •
          <%= @course.start_time.strftime("%-I:%M%P") %> – <%= @course.end_time.strftime("%-I:%M%P") %>
        <% end %>
      </div>

      <div class="mt-2 text-sm text-zinc-400">
        <% if @course.start_date.present? && @course.end_date.present? %>
          <%= @course.start_date.strftime("%b %-d, %Y") %> – <%= @course.end_date.strftime("%b %-d, %Y") %>
        <% elsif @course.start_date.present? %>
          Starts <%= @course.start_date.strftime("%b %-d, %Y") %>
        <% elsif @course.end_date.present? %>
          Ends <%= @course.end_date.strftime("%b %-d, %Y") %>
        <% end %>
      </div>

      <% if @course.end_date.present? %>
        <p class="mt-1 text-xs text-zinc-500">
          Until <%= @course.end_date.strftime("%b %d, %Y") %>
        </p>
      <% end %>
    </div>

    <div class="flex shrink-0 items-center gap-2">
      <%= render Studs::SecondaryButtonComponent.new(
            label: "Edit",
            path: edit_course_path(@course),
            size: :sm
          ) %>

      <%= button_to course_path(@course),
                    method: :delete,
                    form: { data: { turbo_confirm: "Delete this course?" } },
                    class: "inline-block" do %>
        <%= render Studs::SecondaryButtonComponent.new(
              label: "Delete",
              color: :red,
              type: "submit"
            ) %>
      <% end %>
    </div>
  </div>

  <div class="rounded-2xl border border-zinc-800 bg-zinc-950/40 p-5">
    <% if @course.description.present? %>
      <p class="whitespace-pre-wrap text-zinc-200"><%= @course.description %></p>
    <% else %>
      <p class="text-sm text-zinc-400">No description.</p>
    <% end %>
  </div>

  <div class="flex items-center gap-2">
    <%= render Studs::SecondaryButtonComponent.new(
          label: "Back to courses",
          href: courses_path
        ) %>

    <%= render Studs::PrimaryButtonComponent.new(
          label: "New course",
          href: new_course_path,
          color: :orange
        ) %>
  </div>
</div>